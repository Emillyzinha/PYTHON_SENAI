import speech_recognition as sr
from time import sleep
import pyttsx3
import wikipedia
import pywhatkit
import datetime
import pyautogui
from threading import Thread

wikipedia.set_lang('pt')


def falar(texto):
    linguaDoComputador = pyttsx3.init()
    linguaDoComputador.say(texto)
    linguaDoComputador.runAndWait()


class Thr(Thread):
    def __init__(self, fala):
        Thread.__init__(self)
        self.fala = fala

    def run(self):
        falar(texto=self.fala)


rx = Thr(fala='Olá, você quer seguir com a Ana ou com a automatização?')
rx.run()


def chamarAlexa():
    while True:
        microfone = sr.Recognizer()
        with sr.Microphone() as source:

            print("Diga algo: ")
            while True:
                try:
                    microfone.adjust_for_ambient_noise(source)
                    audio = microfone.listen(source)
                    frase = microfone.recognize_google(audio, language='pt-BR')
                    if frase.__contains__("automatização") or frase.__contains__("Automatização"):
                        rx.fala = 'Automatização selecionada!'
                        automatizacao()
                    elif frase.__contains__('ana') or frase.__contains__('Ana'):
                        rx.fala = 'Ana selecionada!'
                        rx.start()
                        print(frase)
                        ouvir_microfone()
                except:
                    continue

        rx.fala = 'Adios'
        break


def automatizacao():
    while True:
        microfone = sr.Recognizer()
        with sr.Microphone() as source:
            rx.fala = 'Estou ouvindo'
            print("Diga alguma coisa: ")
            while True:
                try:
                    audio = microfone.listen(source)
                    microfone.adjust_for_ambient_noise(source)
                    frase = microfone.recognize_google(audio, language='pt-BR')
                    print("Você disse: " + frase)

                    if frase.__contains__('pesquisar'):
                        frase = frase.replace("pesquisar", "")
                        pyautogui.press('winleft')
                        pyautogui.write('google')
                        pyautogui.press('enter')
                        sleep(2)
                        pyautogui.write(frase)
                        pyautogui.press('enter')

                    if frase.__contains__('tocar'):
                        frase = frase.replace("tocar", "")
                        pyautogui.press('winleft')
                        pyautogui.write('google')
                        pyautogui.press('enter')
                        sleep(2)
                        pyautogui.write("youtube.com")
                        pyautogui.press("enter")
                        sleep(3)
                        pyautogui.click(733, 144)
                        pyautogui.write(frase)
                        pyautogui.press('enter')
                        sleep(3)
                        pyautogui.click(614, 330)
                        rx.fala = 'Tocando agora' + frase
                        rx.start()

                    else:
                        continue

                except sr.UnkownValueError:
                    rx.fala = "Desculpe, não entendi"
                    rx.start()
                    continue


def ouvir_microfone():
    while True:
        microfone = sr.Recognizer()
        with sr.Microphone() as source:
            rx.fala = 'Estou ouvindo'
            rx.start()
            print("Diga alguma coisa: ")
            while True:
                try:
                    microfone.adjust_for_ambient_noise(source)
                    audio = microfone.listen(source)
                    frase = microfone.recognize_google(audio, language='pt-BR')
                    print("Você disse: " + frase)

                    # Tocar música
                    if frase.__contains__('Tocar') or frase.__contains__('tocar') or frase.__contains__('toque'):
                        frase = frase.replace("tocar", "")
                        rx.fala = "Tocando agora" + frase
                        rx.start()
                        pywhatkit.playonyt(frase)
                        sleep(5)
                        pyautogui.keyDown("alt")
                        pyautogui.press("tab")
                        pyautogui.keyUp("alt")

                    # Contar uma piada
                    if frase.__contains__('Conte uma piada') or frase.__contains__('conte uma piada'):
                        rx.fala = "A piada aqui é você"
                        rx.start()

                    if frase.__contains__('procure') or frase.__contains__('Procure'):
                        frase = frase.replace("procure", "")
                        resultado = wikipedia.summary(frase, 2)
                        print(resultado)
                        rx.fala = resultado
                        rx.start()

                    if frase.__contains__('horário') or frase.__contains__('que horas são') or frase.__contains__('horas'):
                        hora = datetime.datetime.now().strftime('%H:%M')
                        rx.fala = "Agora são" + hora
                        rx.start()

                    if frase.__contains__('encerrar') or frase.__contains__('desligar'):
                        chamarAlexa()
                        break

                    else:
                        ouvir_microfone()

                except sr.UnkownValueError:
                    rx.fala = "Desculpe, não entendi"
                    rx.start()
                    continue


if __name__ == '__main__':
    chamarAlexa()
